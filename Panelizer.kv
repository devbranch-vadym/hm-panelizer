#:kivy 1.8.0
#:import KivyLexer kivy.extras.highlight.KivyLexer
#:import Factory kivy.factory.Factory


<ActionSpinnerOptions@SpinnerOption>:
    background_color: .4, .4, .4, 1


<ActionSpinner@Spinner+ActionItem>:
    border: 27, 20, 12, 12
    background_normal: 'atlas://data/images/defaulttheme/action_group'
    option_cls: Factory.ActionSpinnerOptions


<ActionSeparator>:
    background_image: 'data/icons/separator.png'
    size_hint_max: (20, 32)
    size_hint: (1.0, 1.0)


<WorkScreen>:
    ScrollView:
        do_scroll_x: False
        do_scroll_y: False


<LayerButton>:
    background_color: 0.2, 0.2, 0.2, 1.0
    color: 0.6, 0.6, 0.6, 1.0
    size_hint_x: None
    size_hint_y: None
    width: 192
    height: 32


<EmptyLabel>:
    size_hint_x: 0.1
    text: ''


<TitleLabel>:
    halign: 'right'
    bold: True
    font_size: 16
    size_hint_x: 0.4


<PostLabel>:
    halign: 'left'
    bold: True
    font_size: 16
    size_hint_x: 0.1


<MenuLabel>:
    color: 0.4, 0.4, 0.4, 1.0
    text: 'Menu item'
    text_size: self.size
    font_size: 16
    halign: 'left'
    valign: 'middle'
    size: (800, 16)


<Settings@Popup>:
    auto_dismiss: False
    size_hint: (None, None)
    size: (512, 512)
    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            orientation: "vertical"
            size_hint: 1.0, 0.95
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.15
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'board gap:'
                TextInput:
                    id: _gap_setting
                    size_hint_x: 0.25
                    multiline: False
                    text: '{:0.2f}'.format(app._settings._gap)
                PostLabel:
                    text: 'mm'
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'rails height:'
                TextInput:
                    id: _rail_setting
                    size_hint_x: 0.25
                    text: '{:d}'.format(int(app._settings._rail))
                PostLabel:
                    text: 'mm'
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'mouse bites per PCB:'
                TextInput:
                    id: _bites_count_setting
                    size_hint_x: 0.25
                    text: '{:d}'.format(int(app._settings._bites_count))
                PostLabel:
                    text: ''
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'mouse bite size:'
                TextInput:
                    id: _bite_setting
                    size_hint_x: 0.25
                    text: '{:d}'.format(int(app._settings._bite))
                PostLabel:
                    text: 'mm'
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'mouse bite hole radius:'
                TextInput:
                    id: _bite_hole_radius_setting
                    size_hint_x: 0.25
                    text: '{:0.2f}'.format(app._settings._bite_hole_radius)
                PostLabel:
                    text: 'mm'
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'mouse bite hole spacing:'
                TextInput:
                    id: _bite_hole_space_setting
                    size_hint_x: 0.25
                    text: '{:0.2f}'.format(app._settings._bite_hole_space)
                PostLabel:
                    text: 'mm'
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'use v-cut:'
                ToggleButton:
                    id: _use_vcut_setting
                    size_hint: 0.25, 0.95
                    state: 'down' if app._settings._use_vcut else 'normal'
                    text: 'yes' if self.state == 'down' else 'no'
                PostLabel:
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'use JLC label:'
                ToggleButton:
                    id: _use_jlc_setting
                    size_hint: 0.25, 0.95
                    state: 'down' if app._settings._use_jlc else 'normal'
                    text: 'yes' if self.state == 'down' else 'no'
                PostLabel:
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.1
                EmptyLabel:
                TitleLabel:
                    text: 'merge slop (error):'
                TextInput:
                    id: _merge_error_setting
                    size_hint_x: 0.25
                    text: '{:0.2f}'.format(app._settings._merge_error)
                PostLabel:
                    text: 'mm'
                EmptyLabel:
            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.15
        BoxLayout:
            orientation: "horizontal"
            size_hint: 1.0, 0.1
            Button:
                size_hint: 0.33, 0.75
                text: 'Defaults'
                on_release: app.settings_default()
            Button:
                size_hint: 0.33, 0.75
                text: 'Cancel'
                on_release: app.settings_cancel()
            Button:
                size_hint: 0.33, 0.75
                text: 'OK'
                on_release: app.settings_close()


<About@Popup>:
    auto_dismiss: True
    size_hint: (None, None)
    size: (512, 350)
    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            orientation: "vertical"
            size_hint: 1.0, 0.85
            TitleLabel:
                size_hint: 1.0, 0.1
                text: ' '
            TitleLabel:
                bold: False
                markup: True
                size_hint: 1.0, 0.1
                text: 'Copyright 2022 [b]HalfMarble LLC[/b]'
            TitleLabel:
                bold: False
                size_hint: 1.0, 0.1
                text: 'Licensed under The MIT License (MIT)'
            TitleLabel:
                size_hint: 1.0, 0.1
                text: ' '
            TitleLabel:
                size_hint: 1.0, 0.1
                text: 'hm-panelizer was made possible thanks to the following:'
            TitleLabel:
                bold: False
                size_hint: 1.0, 0.1
                text: 'www.kicad.org'
            TitleLabel:
                bold: False
                size_hint: 1.0, 0.1
                text: 'kivy.org'
            TitleLabel:
                bold: False
                size_hint: 1.0, 0.1
                text: 'github.com/curtacircuitos/pcb-tools'
            TitleLabel:
                bold: False
                size_hint: 1.0, 0.1
                text: 'github.com/opiopan/pcb-tools-extension'
            TitleLabel:
                bold: False
                size_hint: 1.0, 0.1
                text: 'useiconic.com'
            TitleLabel:
                size_hint: 1.0, 0.1
                text: ' '
        BoxLayout:
            orientation: "horizontal"
            size_hint: 1.0, 0.1
            Button:
                text: 'OK'
                on_release: app.about_ok()


<Error@Popup>:
    auto_dismiss: True
    size_hint: (None, None)
    size: (800, 200)
    BoxLayout:
        orientation: "vertical"
        Label:
            id: _error_label
            size_hint_y: 0.8
            multiline: True
            bold: True
            font_size: 16
            text: ''
        Button:
            size_hint_y: 0.2
            text: 'OK'
            on_release: app.error_close()


<Progress@Popup>:
    auto_dismiss: False
    size_hint: (None, None)
    size: (800, 150)
    RelativeLayout:
        ProgressBar:
            id: _progress_bar
            min: 0
            max: 1
            pos: 75, 0
            size_hint_x: 0.8
        Label:
            id: _progress_bar_label
            text: ''
            bold: True
            font_size: 16
            pos: 10, -20


<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        BoxLayout:
            size_hint_y: None
            height: 30
            Label:
                title_color: 1.0, 0.0, 0.0, 1.0
                background_normal: ''
                background_color: .2, .2, .2, 1
                color: .6, .6, .6, 1
                text: _load_file_chooser.path
                bold: True
                font_size: 16
        FileChooserIconView:
            id: _load_file_chooser
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()
            Button:
                text: "Load"
                on_release: _load_file_chooser.cancel();root.load(_load_file_chooser.path, _load_file_chooser.selection)


<SaveDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: 'vertical'
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: 100
            BoxLayout:
                height: 50
                Label:
                    size_hint_x: 0.075
                    size_hint_y: 0.55
                    bold: True
                    font_size: 16
                    text: 'Folder name:'
                TextInput:
                    id: _save_file_name
                    size_hint_x: 0.75
                    size_hint_y: 0.6
                    multiline: False
                    halign: 'left'
                    font_size: 16
                    text: 'pcb_panelized'
                Label:
                    size_hint_x: 0.02
                    size_hint_y: 0.55
                    bold: True
                    font_size: 16
                    text: ''
            Label:
                title_color: 1.0, 0.0, 0.0, 1.0
                background_normal: ''
                background_color: .2, .2, .2, 1
                color: .6, .6, .6, 1
                text: _save_file_chooser.path
                bold: True
                font_size: 16
        FileChooserIconView:
            id: _save_file_chooser
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()
            Button:
                text: "Export"
                on_release: _save_file_chooser.cancel();root.save(_save_file_chooser.path, _save_file_chooser.selection, _save_file_name.text)


BoxLayout:
    orientation: 'vertical'

    BoxLayout:
        orientation: 'horizontal'
        GridLayout:
            rows: 6
            BoxLayout:
                size_hint_y: None
                height: 10
                canvas:
                    Color:
                        rgb: 0.17, 0.17, 0.17
                    Rectangle:
                        size: self.size
                        pos: self.pos
            BoxLayout:
                size_hint_y: None
                height: 32
                canvas:
                    Color:
                        rgb: 0.17, 0.17, 0.17
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: ''
                    size: (16, 16)
                    size_hint_x: None

                ActionButton:
                    icon: 'data/icons/eye.png'
                    size: (40, 32)
                    size_hint_x: None
                    on_release: app.about()

                ActionSeparator:

                ActionButton:
                    id: _load_button
                    icon: 'data/icons/load.png'
                    size: (44, 32)
                    size_hint_x: None
                    on_release: app.load_pcb_from_disk()
                ActionButton:
                    id: _save_button
                    icon: 'data/icons/save.png'
                    size: (54, 32)
                    size_hint_x: None
                    on_release: app.save_panel_to_disk()

                ActionSeparator:

                ActionToggleButton:
                    id: _vertical_button
                    state: 'down'
                    icon: 'data/icons/vertical.png'
                    size: (44, 32)
                    size_hint_x: None
                    on_release: app.rotate(True)
                ActionToggleButton:
                    id: _horizontal_button
                    icon: 'data/icons/horizontal.png'
                    size: (80, 32)
                    size_hint_x: None
                    on_release: app.rotate(False)

                ActionSeparator:

                ActionToggleButton:
                    id: _panelization_button
                    icon: 'data/icons/panelize.png'
                    size: (44, 32)
                    size_hint_x: None
                    on_release: app.panelize()
                ActionButton:
                    id: _settings_button
                    icon: 'data/icons/settings.png'
                    size: (60, 32)
                    size_hint_x: None
                    on_release: app.settings_open()

                ActionButton:
                    icon: 'data/icons/minus.png'
                    size: (32, 32)
                    size_hint_x: None
                    on_release: app.panelize_column(False)
                ActionButton:
                    icon: 'data/icons/plus.png'
                    size: (32, 32)
                    size_hint_x: None
                    on_release: app.panelize_column(True)
                ActionLabel:
                    id: _panelization_label
                    text: app._panelization_str
                    font_size: 20
                    color: 0.65, 0.65, 0.65
                    bold: True
                    size: (32, 32)
                    size_hint_x: None
                ActionButton:
                    icon: 'data/icons/minus.png'
                    size: (32, 32)
                    size_hint_x: None
                    on_release: app.panelize_row(False)
                ActionButton:
                    icon: 'data/icons/plus.png'
                    size: (32, 32)
                    size_hint_x: None
                    on_release: app.panelize_row(True)

                ActionSeparator:

                ActionButton:
                    icon: 'data/icons/zoom-out.png'
                    size: (32, 32)
                    size_hint_x: None
                    on_release: app.select_zoom(True)
                ActionButton:
                    icon: 'data/icons/zoom-in.png'
                    size: (32, 32)
                    size_hint_x: None
                    on_release: app.select_zoom(False)
                ActionSpinner:
                    id: _zoom_button
                    color: 0.65, 0.65, 0.65
                    text: app._zoom_str
                    values: app._zoom_values_properties
                    on_text: idx = app._zoom_values_properties.index(args[1]); app.select_zoom_index(idx)
                    font_size: 20
                    bold: True
                    size: (96, 32)
                    size_hint_x: None

            BoxLayout:
                size_hint_y: None
                height: 32
                canvas:
                    Color:
                        rgb: 0.17, 0.17, 0.17
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: '      About        Load     Export       Vertical     Horizontal        Panel    Settings    Columns                          Rows            Zoom in/out'
                    color: 0.4, 0.4, 0.4, 1.0
                    text_size: self.size
                    font_size: 14

            BoxLayout:
                size_hint_y: None
                height: 4
                canvas:
                    Color:
                        rgb: 0.1, 0.1, 0.1
                    Rectangle:
                        size: self.size
                        pos: self.pos

            WorkScreen:
                _app: app
                Widget:
                    id: _surface

            BoxLayout:
                size_hint_y: None
                height: 32
                canvas:
                    Color:
                        rgb: 0.05, 0.05, 0.05
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    id: _status_label
                    color: 0.4, 0.4, 0.4, 1.0
                    text: ' Status: '
                    text_size: self.size
                    font_size: 12
                    halign: 'left'
                    valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint_x: None
            width: 200
            spacing: 2
            padding: 4
            canvas:
                Color:
                    rgb: 0.05, 0.05, 0.05
                Rectangle:
                    size: self.size
                    pos: self.pos
            Widget:
                size_hint_x: None
                size_hint_y: None
                width: 192
                height: 10
            Label:
                title_color: 1.0, 0.0, 0.0, 1.0
                background_normal: ''
                background_color: .2, .2, .2, 1
                color: .6, .6, .6, 1
                size_hint_x: None
                size_hint_y: None
                width: 192
                height: 32
                text: 'PCB layers:'
                bold: True
                font_size: 20
            LayerButton:
                id: _pcb
                text: 'Pcb'
                state: 'down'
                on_state: app.layer_toggle(0, self.state);
            LayerButton:
                id: _outline_verified
                text: 'Outline (verification)'
                on_state: app.layer_toggle(12, self.state);
            LayerButton:
                id: _top1
                text: 'Top traces'
                state: 'down'
                on_state: app.layer_toggle(5, self.state);
            LayerButton:
                id: _top3
                text: 'Top silk'
                state: 'down'
                on_state: app.layer_toggle(3, self.state)
            LayerButton:
                id: _top4
                text: 'Top mask'
                state: 'down'
                on_state: app.layer_toggle(4, self.state)
            LayerButton:
                id: _top2
                text: 'Top paste'
                on_state: app.layer_toggle(2, self.state)
            LayerButton:
                id: _bottom1
                text: 'Bottom traces'
                on_state: app.layer_toggle(6, self.state)
            LayerButton:
                id: _bottom3
                text: 'Bottom silk'
                on_state: app.layer_toggle(8, self.state)
            LayerButton:
                id: _bottom4
                text: 'Bottom mask'
                on_state: app.layer_toggle(7, self.state)
            LayerButton:
                id: _bottom2
                text: 'Bottom paste'
                on_state: app.layer_toggle(9, self.state)
            LayerButton:
                id: _drillnpth
                text: 'Drill NPTH'
                state: 'down'
                on_state: app.layer_toggle(10, self.state)
            LayerButton:
                id: _drillpth
                text: 'Drill PTH'
                state: 'down'
                on_state: app.layer_toggle(11, self.state)
            Widget:
